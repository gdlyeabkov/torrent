<template>
    <div>
        <Header />
        <div class="main">
            <span class="">
                PSPaudioware - PSP Plugins Bundle 2021.9 VST, VST3, AAX x64 [09.2021]
            </span>
            <div class="socialsMedia searchByDistributionsHeader">
                <img src="https://static.t-ru.org/templates/v1/images/soc_sprite.png" alt="">
            </div>
            <div class="distributtion">
                <div class="distributtionAuthor">
                    <span class="authorName">
                        alexpober
                    </span>
                    <img width="75px" src="https://static.t-ru.org/ranks/s_topseed_7.gif" alt="">
                    <img width="85px" src="https://static.t-ru.org/avatars/0/79/3992479.jpg" alt="">
                    <span class="authorMeta">
                        Стаж: 13 лет 4 месяца
                    </span>
                    <span class="authorMeta">
                        Сообщений: 118
                    </span>
                    <img class="authorCountry" src="../assets/flag.png" alt="" />
                    <div class="postAuthorFooter">
                        <span>
                            [
                            <span class="postQuote">    
                                Профиль
                            </span>
                            ]
                            [
                            <span class="postQuote">
                                ЛС
                            </span>
                            ]
                        </span>
                    </div>
                </div>
                <div class="postContent">
                    <div class="postContentHeader">
                        <div>
                            <span class="postDate">
                                13-Сен-21 15:03
                            </span>
                            <span>
                                (спустя 13 мин.) 
                            </span>
                        </div>
                        <div>
                            <span>
                                [
                                <span class="postQuote">
                                    Код
                                </span>
                                ]
                            </span>
                        </div>
                    </div>
                    <p class="distributionHeader">
                        {{ distributtion.theme }}
                    </p>
                    <div class="distributionContent">
                        <div class="distributionContentAside">
                            <span>
                                <span class="distributionContentAsideHeader">
                                    Год/Дата Выпуска:
                                </span>
                                 09.2021
                            </span>
                            <span>
                                <span class="distributionContentAsideHeader">
                                    Версия:
                                </span>
                                2021.9                                
                            </span>
                            <span>
                                <span class="distributionContentAsideHeader">
                                    Разработчик:
                                </span>
                                 PSPaudioware
                            </span>
                            <span>
                                <span class="distributionContentAsideHeader">
                                    Сайт разработчика:
                                </span>
                                 pspaudioware
                            </span>
                            <span>
                                <span class="distributionContentAsideHeader">
                                    Формат:
                                </span>
                                 VST, VST3, AAX
                            </span>
                            <span>
                                <span class="distributionContentAsideHeader">
                                    Разрядность:
                                </span>
                                 64bit
                            </span>
                            <span>
                                <span class="distributionContentAsideHeader">
                                    Таблэтка:
                                </span>
                                 вылечено (поставь и работай) | R2R
                            </span>
                            <span>
                                <span class="distributionContentAsideHeader">
                                    Системные требования:
                                </span>
                                 • Windows 10
                            </span>
                            <span>
                            • VST, VST3 compatible application
                            </span>
                            <span>
                                <span class="distributionContentAsideHeader">
                                    Описание:
                                </span>
                                 Плагин сет от копании PSPaudioware:
                            </span>
                            <span>
                                PSPaudioware.PSP.2445.EMT.v1.3.8
                            </span>
                            <span>
                                PSPaudioware.PSP.E27.v1.7.1
                            </span>
                            <span>
                                PSPaudioware.PSP.InfiniStrip.v1.2.1
                            </span>
                            <span>
                                PSPaudioware.PSP.PianoVerb2.v2.5.1
                            </span>
                            <span>
                                PSPaudioware.PSP.VintageWarmer2.v2.9.0 
                            </span>
                        </div>
                        <img class="distributionContentPicture" src="https://i115.fastpic.org/big/2021/0913/e0/1c1629dfc23fe397380265260aeb4fe0.jpg?r=1" alt="">
                    </div>
                    <div class="toggleList">
                        <button class="toggleListBtn">
                            +
                        </button>
                        <span class="lastThanksgivers">
                            Скриншоты
                        </span>
                    </div>
                    <div class="toggleList">
                        <button class="toggleListBtn">
                            +
                        </button>
                        <span class="lastThanksgivers">
                            Скриншоты окна About
                        </span>
                    </div>
                    <div class="distributtionDownload">
                        <div class="distributtionDownloadMeta distributtionDownloadMetaHeader">
                            Как качать FAQ Покраснели раздачи?
                        </div>
                        <table class="distributtionDownloadTable">
                            <tr>
                                <td>
                                    Зарегистрирован: 	
                                </td>
                                <td>
                                    13-Сен-21 14:49 Скачан: 1,134 раза 
                                </td>
                                <td rowspan="4">
                                    <div class="downloadCell">
                                        <div @click="downloadDistributtion()" class="downloadTorrent">
                                            <img src="https://static.t-ru.org/templates/v1/images/attach_big.gif" alt="">
                                            <span class="">
                                                Скачать .torrent
                                            </span>
                                        </div>
                                        <span>
                                            15 КB
                                        </span>
                                        <button @click="showListOfFiles = !showListOfFiles">
                                            Список файлов
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Тип:
                                </td>
                                <td>
                                    обычная
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Статус:
                                </td>
                                <td>
                                    * не проверено 
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Размер:
                                </td>
                                <td>
                                    91.7 MB 
                                    <img width="15px" src="https://static.t-ru.org/templates/v1/images/magnet_1.svg" alt="">
                                    Скачать по magnet-ссылке
                                </td>
                            </tr>
                        </table>
                        <div class="distributtionDownloadMeta distributtionDownloadMetaFooter">
                            Аудит юзабилити вашего сайта, тест на уязвимости и анализ текстов   
                        </div>
                    </div>
                    <div class="listOfFiles" v-if="showListOfFiles">
                        <div class="listOfFilesHeader">
                            <div>
                                <span>
                                    Свернуть
                                </span>
                                <span>
                                    Развернуть
                                </span>
                                <span>
                                    Переключить
                                </span>
                            </div>
                            <div>
                                <span>
                                    Имя
                                </span>
                                <span>
                                    Размер
                                </span>
                                <span>
                                    Сравнить с др. раздачей
                                </span>
                                <span>
                                    Увел./умен. окно
                                </span>
                            </div>
                        </div>
                        <div class="files">
                            <div class="file">
                                <span class="material-icons">
                                    arrow_drop_down
                                </span>
                                <span class="folder material-icons">
                                    folder
                                </span>
                                <span class="fileName">
                                    ./PSPaudioware PSP Plugins Bundle 2021.9
                                </span>
                                <span class="fileSize">
                                    91.69 MB
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="thanksBtnContainer">
                        <button class="btn btn-light thanksBtn">
                            Сказать "Cпасибо"
                        </button>
                    </div>
                    <div class="toggleList">
                        <button class="toggleListBtn">
                            +
                        </button>
                        <span class="lastThanksgivers">
                            Последние поблагодарившие
                        </span>
                    </div>
                    <hr />
                    <p>
                        Нажимая на "Скачать .torrent", вы соглашаетесь с положением, что с этого момента вам никто ничего здесь не должен.
                    </p>
                </div>
            </div>
            <div class="ads">
                <img src="https://cdn.admitad-connect.com/public/bs/2021/05/06/728x90_img_F_Dortmund.cc7f.jpg" alt="">
            </div>
            <div class="post firstPost">
                <div class="postAuthor">
                    <span class="authorName">
                        alexpober
                    </span>
                    <img width="85px" src="https://static.t-ru.org/avatars/0/79/3992479.jpg" alt="">
                    <span class="authorMeta">
                        Стаж: 13 лет 4 месяца
                    </span>
                    <span class="authorMeta">
                        Сообщений: 118
                    </span>
                    <img class="authorCountry" src="../assets/flag.png" alt="" />
                    <div class="postAuthorFooter">
                        <span>
                            [
                            <span class="postQuote">    
                                Профиль
                            </span>
                            ]
                            [
                            <span class="postQuote">
                                ЛС
                            </span>
                            ]
                        </span>
                    </div>
                </div>
                <div class="postContent">
                    <div class="postContentHeader">
                        <div>
                            <span class="postDate">
                                13-Сен-21 15:03
                            </span>
                            <span>
                                (спустя 13 мин.) 
                            </span>
                        </div>
                        <div>
                            <span>
                                [
                                <span class="postQuote">
                                    Цитировать
                                </span>
                                ]
                            </span>
                        </div>
                    </div>
                    <div class="postMessage">
                        <span>
                            МЕГАМОЩЬ! 
                        </span>
                    </div>
                </div>
            </div>
            <div class="post secondPost">
                <div class="postAuthor">
                    <span class="authorName">
                        alexpober
                    </span>
                    <img width="85px" src="https://static.t-ru.org/avatars/0/79/3992479.jpg" alt="">
                    <span class="authorMeta">
                        Стаж: 13 лет 4 месяца
                    </span>
                    <span class="authorMeta">
                        Сообщений: 118
                    </span>
                    <img class="authorCountry" src="../assets/flag.png" alt="" />
                    <div class="postAuthorFooter">
                        <span>
                            [
                            <span class="postQuote">    
                                Профиль
                            </span>
                            ]
                            [
                            <span class="postQuote">
                                ЛС
                            </span>
                            ]
                        </span>
                    </div>
                </div>
                <div class="postContent">
                    <div class="postContentHeader">
                        <div>
                            <span class="postDate">
                                13-Сен-21 15:03
                            </span>
                            <span>
                                (спустя 13 мин.) 
                            </span>
                        </div>
                        <div>
                            <span>
                                [
                                <span class="postQuote">
                                    Цитировать
                                </span>
                                ]
                            </span>
                        </div>
                    </div>
                    <div class="postMessage">
                        <span>
                            МЕГАМОЩЬ! 
                        </span>
                    </div>
                </div>
            </div>

            <div class="searchByDistributionsHeader">
                <span>
                    Быстрый ответ
                </span>
            </div>
            <div class="distributtionActions">
                <span>
                    Ответить
                </span>
                <span>
                    Главная »
                </span>
                <span>
                    Программы и Дизайн » 
                </span>
                <span>
                    Программы для работы с мультимедиа и 3D » 
                </span>
                <span>
                    Плагины для обработки звука
                </span>
            </div>
            <div class="selectForum">
                <select class="form-select h-75 w-25" aria-label="Default select example">
                    <option selected>Браузерные и клиентские онлайн-игры</option>
                </select>
            </div>
        </div>
        <Footer />
    </div>
</template>

<script>
import Header from '@/components/Header.vue'
import Footer from '@/components/Footer.vue'

import * as jwt from 'jsonwebtoken'

export default {
    name: 'Distribution',
    data(){
        return {
            showListOfFiles: false,
            torrenter: {},
            distributtion: {},
            token: window.localStorage.getItem("torrentiotoken")
        }
    },
    mounted(){
        jwt.verify(this.token, 'torrentiosecret', (err, decoded) => {
            if (err) {
                this.$router.push({ name: 'Home' })
            } else {
                fetch(`http://localhost:4000/api/torrenters/get/?torrenterid=${decoded.torrenter}`, {
                    mode: 'cors',
                    method: 'GET'
                }).then(response => response.body).then(rb  => {
                    const reader = rb.getReader()
                    return new ReadableStream({
                    start(controller) {
                        function push() {
                            reader.read().then( ({done, value}) => {
                                if (done) {
                                    console.log('done', done);
                                    controller.close();
                                    return;
                                }
                                controller.enqueue(value);
                                console.log(done, value);
                                push();
                            })
                        }
                        push();
                    }
                });
            }).then(stream => {
                return new Response(stream, { headers: { "Content-Type": "text/html" } }).text();
            })
            .then(result => {
                    if(JSON.parse(result).status.includes('OK')){
                        this.torrenter = JSON.parse(result).torrenter

                        fetch(`http://localhost:4000/api/distributions/get/?distributionid=${this.$route.query.distributtionid}`, {
                            mode: 'cors',
                            method: 'GET'
                        }).then(response => response.body).then(rb  => {
                            const reader = rb.getReader()
                            return new ReadableStream({
                                start(controller) {
                                    function push() {
                                        reader.read().then( ({done, value}) => {
                                            if (done) {
                                                console.log('done', done);
                                                controller.close();
                                                return;
                                            }
                                            controller.enqueue(value);
                                            console.log(done, value);
                                            push();
                                        })
                                    }
                                    push();
                                }
                            });
                        }).then(stream => {
                            return new Response(stream, { headers: { "Content-Type": "text/html" } }).text();
                        })
                        .then(result => {
                           if(JSON.parse(result).status.includes('OK')){
                               console.log("получаем раздачу")
                               this.distributtion = JSON.parse(result).distribution
                           } else if(JSON.parse(result).status.includes('Error')){

                           } 
                        })

                    } else if(JSON.parse(result).status.includes('Error')){
                        
                    }
                })
            }
        })
    },
    methods: {
        downloadDistributtion(){
            window.location = `http://localhost:4000/api/distributtions/download/?distributtiontheme=${this.distributtion.theme}`
        }
    },
    components: {
        Header,
        Footer
    }
}
</script>

<style scoped>
    
    .main {
        margin: auto;
        width: 98%;
        display: flex;
        flex-direction: column;
    }

    .searchByDistributionsHeader {
        height: 35px;
        background-color: rgb(0, 100, 255);
        font-weight: bolder;
        color: rgb(100, 200, 255);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .postContent {
        width: 100%;
    }

    .postContentHeader {
        display: flex;
        justify-content: space-between;
        border: 1px solid rgb(150, 150, 150);
        border-left: none;
        height: 35px;
    }

    .post {
        display: flex;
    }

    .postAuthor {
        display: flex;
        flex-direction: column;
        border: 1px solid rgb(150, 150, 150);
        width: 15%;
        box-sizing: border-box;
        padding-left: 5px;
    }

    .authorName {
        font-weight: bolder;
        color: rgb(100, 100, 255);
        cursor: pointer;
    }

    .authorName:hover {
        text-decoration: underline;
    }

    .firstPost {
        background-color: rgb(215, 215, 215);
    }

    .secondPost {
        background-color: rgb(235, 235, 235);
    }

    .postAuthorFooter {
        border-top: 1px solid rgb(150, 150, 150);
    }

    .postMessage {
        border: 1px solid rgb(150, 150, 150);
        height: calc(100% - 35px);
        border-left: none;
        border-top: none;
    }

    .postContentHeader, .postMessage {
        box-sizing: border-box;
        padding: 0px 15px;
    }

    .authorMeta {
        font-size: 12px;
    }

    .postQuote, .postDate {
        color: rgb(100, 100, 255);
        cursor: pointer;
        font-size: 12px;
    }

    .authorCountry {
        width: 25px;
    }

    .secondPost > .postAuthor, .secondPost > .postContent > .postContentHeader {
        border-top: none;
    }

    .distributtion {
        display: flex;
        width: 100%;
        background-color: rgb(240, 240, 240);
    }

    .distributtionAuthor {
        display: flex;
        flex-direction: column;
        border: 1px solid rgb(150, 150, 150);
        width: 15%;
        box-sizing: border-box;
        padding-left: 5px;
        border-bottom: none;
    }

    .distributionHeader {
        font-weight: bolder;
        text-align: center;
        font-size: 24px;
    }

    .distributionContent {
        display: flex;
        justify-content: space-between;
        box-sizing: border-box;
        padding: 15px;
    }

    .distributionContentAside {
        display: flex;
        flex-direction: column;
    }

    .distributionContentPicture {
        width: 350px;
        height: 350px;
    }

    .lastThanksgivers {
        font-weight: bolder;
        font-size: 12px;
    }

    .toggleList {
        border: 1px solid rgb(215, 215, 215);
        background-color: rgb(235, 235, 235);
        display: flex;
        align-items: center;
        width: 90%;
        margin: 15px auto;
        height: 20px;
    }

    .toggleListBtn {
        margin: 5px 20px;
        border: 1px solid rgb(150, 150, 150);
        max-width: 15px;
        height: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
    }

    .thanksBtn {
        font-weight: bolder;
        border: 1px solid rgb(150, 150, 150);
        width: 175px;
        align-self: center;
    }

    .thanksBtnContainer {
        display: flex;
        justify-content: center;        
    }

    .distributtionDownloadMeta {
        background-color: rgb(215, 215, 255);
        height: 30px;
        color: rgb(125, 125, 255);
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid rgb(185, 185, 185);
    }

    .distributtionDownload {
        display: flex;
        flex-direction: column;
        width: 85%;
        margin: 15px auto;
        text-align: center;
    }
    
    .distributtionDownloadMetaHeader {
        border-bottom: none;
    }

    .distributtionDownloadMetaFooter {
        font-weight: bolder;
        border-top: none;
    }

    .distributtionDownloadTable > tr > td {
        border: 1px solid rgb(185, 185, 185);
    }

    .downloadCell {
        display: flex;
        flex-direction: column;
    }

    .downloadCell > * {
        align-self: center;
    }

    .downloadTorrent {
        display: flex;
        flex-direction: column;
        cursor: pointer;
    }

    .downloadTorrent > span {
        color: rgb(0, 100, 255);
        font-weight: bolder;
    }

    .downloadTorrent:hover, .downloadTorrent > span:hover {
        color: rgb(200, 100, 0) !important;
    }

    .downloadTorrent > * {
        align-self: center;
    }

    .distributionContentAsideHeader {
        font-weight: bolder;
    }

    .socialsMedia {
        display: flex;
        justify-content: flex-end;
        box-sizing: border-box;
        padding-right: 15px;
    }

    .ads {
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid rgb(180, 180, 180);
        width: 100%;
        height: 115px;
        background-color: rgb(220, 220, 220);
        border-bottom: none;
    }

    .selectForum {
        display: flex;
        justify-content: flex-end;
    }

    .distributtionActions > span {
        color: rgb(50, 50, 255);
        font-weight: bolder;
        cursor: pointer;
    }

    .listOfFiles {
        margin: 20px auto;
        width: 85%;
    }

    .listOfFilesHeader {
        display: flex;
        justify-content: space-between;
        box-sizing: border-box;
        padding: 0px 15px;
    }

    .listOfFilesHeader > div > span {
        color: rgb(50, 50, 255);
        margin: 0px 5px;
        font-size: 12px;
        cursor: pointer;
    }

    .listOfFilesHeader > div > span:hover {
        color: rgb(200, 75, 0);
    }

    .files {
        height: 250px;
        border: 1px solid rgb(225, 225, 225);
        background-color: rgb(255, 255, 255);
        box-sizing: border-box;
        padding: 10px;
    }

    .file {
        display: flex;
        align-items: center;
    }

    .fileName {
        font-weight: bolder;
        margin: 0px 5px;
    }

    .fileSize {
        font-weight: bolder;
        color: rgb(215, 0, 0);
        margin: 0px 5px;
    }

    .folder {
        color: rgb(200, 200, 255);
    }

</style>
